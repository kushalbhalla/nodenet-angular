(self.webpackChunknodenet=self.webpackChunknodenet||[]).push([[784],{3784:(t,e,o)=>{"use strict";o.r(e),o.d(e,{PostModule:()=>k});var i=o(1116),n=o(2006),s=o(6304),r=o(3835),c=o(6599),p=o(1267),a=o(5366),u=o(2935),g=o(3824),l=o(2255),d=o(8845),m=o(4369);function f(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"div",2),a.TgZ(1,"div",3),a.TgZ(2,"div",4),a.NdJ("click",function(){return a.CHM(t),a.oxw().goToUser()}),a._UZ(3,"img",5),a.TgZ(4,"span",6),a._uU(5),a.qZA(),a.TgZ(6,"span",7),a._uU(7),a.qZA(),a.qZA(),a.qZA(),a.TgZ(8,"div",8),a.TgZ(9,"span",9),a._uU(10),a.qZA(),a._UZ(11,"img",10),a.qZA(),a.TgZ(12,"div",11),a.TgZ(13,"div",12),a.TgZ(14,"button",13),a.NdJ("click",function(){return a.CHM(t),a.oxw().updatePostLikes()}),a._UZ(15,"img",14),a.qZA(),a.TgZ(16,"span",15),a._uU(17),a.qZA(),a.qZA(),a.qZA(),a.qZA()}if(2&t){const t=a.oxw();a.xp6(3),a.Q6J("src",t.userImage,a.LSH),a.xp6(2),a.hij(" ",t.post.user.username," "),a.xp6(2),a.Oqu(t.post.post.createdAt),a.xp6(3),a.Oqu(t.post.post.description),a.xp6(1),a.hYB("src","",t.serverDir,"",t.post.post.imgUrl,"",a.LSH),a.xp6(6),a.hij("",t.post.post.likes.length," liked")}}let h=(()=>{class t{constructor(t,e,o,i,s,p){this.router=t,this.matDialog=e,this.route=o,this.postService=i,this.dataStorageService=s,this.authService=p,this.router.events.pipe((0,r.h)(t=>t instanceof n.OD),(0,c.b)(()=>this.matDialog.closeAll())).subscribe()}ngOnInit(){var t=this;return(0,s.Z)(function*(){t.serverDir=p.N.IMAGES_PATH,t.route.params.subscribe(e=>{t.postId=e.id}),t.userSubscription=t.authService.user.subscribe(e=>{t.user=e}),t.dataStorageService.getPost(t.postId),t.postSubscription=t.postService.postChanged.subscribe(e=>{t.post=e,t.userImage=""===t.post.user.profilePicture||"assets/defaultProfile.png"===t.post.user.profilePicture?"assets/defaultProfile.png":t.serverDir+t.post.user.profilePicture}),t.post=t.postService.getPost()})()}goToUser(){this.router.navigate(this.user._id===this.post.post.creator?["/account"]:["user-profile",this.post.post.creator,"view"])}updatePostLikes(){this.dataStorageService.likePost(this.post.post._id).subscribe(t=>{this.post.post.likes=t.likes,this.postService.updatePost(this.post)})}ngOnDestroy(){this.postSubscription.unsubscribe(),this.userSubscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(n.F0),a.Y36(u.uw),a.Y36(n.gz),a.Y36(g.L),a.Y36(l.Z),a.Y36(d.e))},t.\u0275cmp=a.Xpm({type:t,selectors:[["app-show-post"]],decls:2,vars:1,consts:[[1,"post__wrapper"],["class","post__card",4,"ngIf"],[1,"post__card"],[1,"postTop"],[1,"postTopLeft",3,"click"],["alt","",1,"postProfileImg",3,"src"],[1,"postUsername"],[1,"postDate"],[1,"postCenter"],[1,"postText"],["alt","",1,"postImg",3,"src"],[1,"postBottom"],[1,"postBottomLeft"],["mat-icon-button","",3,"click"],["src","assets/like.png","alt","",1,"likeIcon"],[1,"postLikeCounter"]],template:function(t,e){1&t&&(a.TgZ(0,"div",0),a.YNc(1,f,18,7,"div",1),a.qZA()),2&t&&(a.xp6(1),a.Q6J("ngIf",e.post))},directives:[i.O5,m.lW],styles:[".post__wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:600px;margin-top:5%}.post__card[_ngcontent-%COMP%]{margin-bottom:30px}.postTop[_ngcontent-%COMP%]{justify-content:space-between}.postTop[_ngcontent-%COMP%], .postTopLeft[_ngcontent-%COMP%]{display:flex;align-items:center}.postTopLeft[_ngcontent-%COMP%]{cursor:pointer}.postProfileImg[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;object-fit:cover}.postUsername[_ngcontent-%COMP%]{font-size:17px;font-weight:500;margin:0 10px}.postDate[_ngcontent-%COMP%]{font-size:12px}.postText[_ngcontent-%COMP%]{font-size:18px;font-weight:400}.postCenter[_ngcontent-%COMP%]{margin:20px 0}.postImg[_ngcontent-%COMP%]{margin-top:20px;max-width:100%;max-height:500px;object-fit:contain}.postBottom[_ngcontent-%COMP%]{justify-content:space-between}.postBottom[_ngcontent-%COMP%], .postBottomLeft[_ngcontent-%COMP%]{display:flex;align-items:center}.likeIcon[_ngcontent-%COMP%]{width:24px;height:24px;margin-right:10px;cursor:pointer}.postLikeCounter[_ngcontent-%COMP%]{font-size:15px;padding-left:20px}.postCommentText[_ngcontent-%COMP%]{cursor:pointer;border-bottom:1px dashed gray;font-size:15px}"]}),t})();var _=o(1041),b=o(7812),x=o(7307),v=o(9624),P=o(2797);function C(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"div",14),a.TgZ(1,"label",15),a._UZ(2,"mat-icon",16),a._uU(3," Select Image "),a.qZA(),a.TgZ(4,"input",17),a.NdJ("change",function(e){return a.CHM(t),a.oxw(2).onFileChange(e)}),a.qZA(),a.qZA()}}function Z(t,e){if(1&t&&a._UZ(0,"img",18),2&t){const t=a.oxw(2);a.Q6J("src",t.imagePath,a.LSH)}}function S(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"button",19),a.NdJ("click",function(){return a.CHM(t),a.oxw(2).onClearImage()}),a._UZ(1,"mat-icon",20),a.qZA()}}function w(t,e){if(1&t&&(a.TgZ(0,"button",21),a._uU(1," Save "),a.qZA()),2&t){const t=a.oxw(2);a.Q6J("disabled",!t.postForm.valid)}}function M(t,e){if(1&t&&(a.TgZ(0,"button",21),a._uU(1," Update "),a.qZA()),2&t){const t=a.oxw(2);a.Q6J("disabled",!t.imagePath)}}function I(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"form",3),a.NdJ("ngSubmit",function(){return a.CHM(t),a.oxw().onFormSubmit()}),a.TgZ(1,"div",4),a.TgZ(2,"label",5),a._uU(3,"Description"),a.qZA(),a._UZ(4,"input",6),a.qZA(),a.TgZ(5,"div",7),a.YNc(6,C,5,0,"div",8),a.YNc(7,Z,1,1,"img",9),a.YNc(8,S,2,0,"button",10),a.qZA(),a.TgZ(9,"div",11),a.YNc(10,w,2,1,"button",12),a.YNc(11,M,2,1,"button",12),a.TgZ(12,"button",13),a.NdJ("click",function(){return a.CHM(t),a.oxw().onCancel()}),a._uU(13," Cancel "),a.qZA(),a.qZA(),a.qZA()}if(2&t){const t=a.oxw();a.Q6J("formGroup",t.postForm),a.xp6(6),a.Q6J("ngIf",!t.imagePath),a.xp6(1),a.Q6J("ngIf",t.imagePath),a.xp6(1),a.Q6J("ngIf",t.imagePath),a.xp6(2),a.Q6J("ngIf",!t.editMode),a.xp6(1),a.Q6J("ngIf",t.editMode)}}let O=(()=>{class t{constructor(t,e,o,i,n,s,r){this.dataStorageService=t,this.matIconRegistry=e,this.domSanitizer=o,this.authService=i,this.router=n,this.route=s,this.postService=r,this.editMode=!1,this.matIconRegistry.addSvgIcon("media",this.domSanitizer.bypassSecurityTrustResourceUrl("../../../assets/icons/media.svg")),this.matIconRegistry.addSvgIcon("close",this.domSanitizer.bypassSecurityTrustResourceUrl("../../../assets/icons/close.svg"))}ngOnInit(){var t=this;return(0,s.Z)(function*(){t.userSubscription=t.authService.user.subscribe(e=>{t.user=e}),t.route.params.subscribe(e=>{t.postId=e.id,t.editMode=null!=e.id}),t.editMode&&(yield t.dataStorageService.getPost(t.postId)),t.initForm()})()}onFileChange(t){if(t.target.files&&t.target.files[0]){this.postForm.patchValue({fileSource:t.target.files[0]});var e=new FileReader;e.readAsDataURL(t.target.files[0]),e.onload=t=>{this.imagePath=t.target.result}}}onFormSubmit(){const t=localStorage.getItem("token"),e=new FormData;e.append("image",this.postForm.value.fileSource),e.append("description",this.postForm.value.description),e.append("userId",this.user._id),this.editMode?(e.append("imageUrl",this.postService.getPost().post.imgUrl),this.dataStorageService.updatePost(this.postId,e).subscribe(e=>{const o=new b.n(this.user._id,this.user.email,this.user.username,this.user.profilePicture,this.user.phoneNumber,this.user.bio,this.user.followers,this.user.followings,e,this.user.createdAt,this.user.updatedAt,t);this.authService.user.next(o),this.onCancel()})):this.dataStorageService.createPost(e).subscribe(e=>{const o=new b.n(this.user._id,this.user.email,this.user.username,this.user.profilePicture,this.user.phoneNumber,this.user.bio,this.user.followers,this.user.followings,e,this.user.createdAt,this.user.updatedAt,t);this.authService.user.next(o),this.onCancel()}),this.router.navigate(["/account"],{relativeTo:this.route})}initForm(){let t="";if(this.editMode){const e=this.postService.getPost();t=e.post.description,this.imagePath=p.N.IMAGES_PATH+e.post.imgUrl}this.postForm=new _.cw({description:new _.NI(t,_.kI.required),fileSource:new _.NI("",_.kI.required)})}onCancel(){this.postForm.reset(),this.onClearImage()}onClearImage(){this.imagePath=""}ngOnDestroy(){this.userSubscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(l.Z),a.Y36(x.jv),a.Y36(v.H7),a.Y36(d.e),a.Y36(n.F0),a.Y36(n.gz),a.Y36(g.L))},t.\u0275cmp=a.Xpm({type:t,selectors:[["app-create-post"]],decls:5,vars:1,consts:[[1,"post__wrapper"],[1,"title"],["class","form__group",3,"formGroup","ngSubmit",4,"ngIf"],[1,"form__group",3,"formGroup","ngSubmit"],[1,"form__field"],["for","description",1,"form__label"],["type","text","id","description","formControlName","description",1,"form__input"],[1,"image__box"],["class","image__selection",4,"ngIf"],["id","image__previewed",3,"src",4,"ngIf"],["type","button","id","unseclect__button","mat-icon-button","",3,"click",4,"ngIf"],[1,"control__buttons"],["mat-raised-button","","class","submit__button","type","submit",3,"disabled",4,"ngIf"],["mat-raised-button","","type","button",1,"control__button",3,"click"],[1,"image__selection"],["for","file-upload",1,"custom-file-upload"],["svgIcon","media"],["id","file-upload","type","file",3,"change"],["id","image__previewed",3,"src"],["type","button","id","unseclect__button","mat-icon-button","",3,"click"],["svgIcon","close"],["mat-raised-button","","type","submit",1,"submit__button",3,"disabled"]],template:function(t,e){1&t&&(a.TgZ(0,"mat-card",0),a.TgZ(1,"div",1),a.TgZ(2,"p"),a._uU(3,"Create Post"),a.qZA(),a.qZA(),a.YNc(4,I,14,6,"form",2),a.qZA()),2&t&&(a.xp6(4),a.Q6J("ngIf",e.postForm))},directives:[P.a8,i.O5,_._Y,_.JL,_.sg,_.Fj,_.JJ,_.u,m.lW,x.Hw],styles:[".post__wrapper[_ngcontent-%COMP%]{margin-top:5%;width:500px;padding:10px}.title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-size:25px;font-weight:500;margin-bottom:30px}.form__group[_ngcontent-%COMP%]{height:calc(100% - 60px)}.form__field[_ngcontent-%COMP%], .form__group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form__field[_ngcontent-%COMP%]{margin-bottom:20px}.form__label[_ngcontent-%COMP%]{font-size:22px;padding-right:10px;margin-bottom:10px}.form__input[_ngcontent-%COMP%]{background:#0000;margin:0;outline-width:0;height:25px;padding-left:5px;font-size:16px;border:1px solid #ccc}.image__box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:475px;border:1px solid #ccc;margin-bottom:10px}#image__previewed[_ngcontent-%COMP%]{width:100%;height:100%;opacity:1}.image__box[_ngcontent-%COMP%]:hover   #image__previewed[_ngcontent-%COMP%]{opacity:.9}.image__box[_ngcontent-%COMP%]:hover   #unseclect__button[_ngcontent-%COMP%]{opacity:1}#unseclect__button[_ngcontent-%COMP%]{margin-left:-40px;opacity:0;align-self:flex-start}.control__buttons[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row-reverse}.submit__button[_ngcontent-%COMP%]{color:#fff;background-color:#007fff;margin-left:20px}.control__button[_ngcontent-%COMP%]{color:#fff;background-color:red}input[type=file][_ngcontent-%COMP%]{display:none}.custom-file-upload[_ngcontent-%COMP%]{display:flex;align-items:center;border:1px solid #ccc;display:inline-block;padding:6px 12px;cursor:pointer}"]}),t})();const T=[{path:"",redirectTo:"create"},{path:"create",component:O},{path:":id/view",component:h},{path:":id/edit",component:O}];let y=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({imports:[[n.Bz.forChild(T)],n.Bz]}),t})();var A=o(3128);let k=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({imports:[[i.ez,y,A.q,_.UX]]}),t})()}}]);