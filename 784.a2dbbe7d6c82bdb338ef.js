(self.webpackChunknodenet=self.webpackChunknodenet||[]).push([[784],{3784:(t,e,o)=>{"use strict";o.r(e),o.d(e,{PostModule:()=>F});var i=o(1116),n=o(5425),s=o(2006),r=o(6304),c=o(3835),a=o(6599),p=o(1267),u=o(5366),g=o(2935),l=o(3824),d=o(2255),f=o(8845),m=o(9410),h=o(4369);function _(t,e){1&t&&u._UZ(0,"app-loading-spinner")}function b(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"div",4),u.TgZ(1,"div",5),u.TgZ(2,"div",6),u.NdJ("click",function(){return u.CHM(t),u.oxw().goToUser()}),u._UZ(3,"img",7),u.TgZ(4,"span",8),u._uU(5),u.qZA(),u.TgZ(6,"span",9),u._uU(7),u.qZA(),u.qZA(),u.qZA(),u.TgZ(8,"div",10),u.TgZ(9,"span",11),u._uU(10),u.qZA(),u._UZ(11,"img",12),u.qZA(),u.TgZ(12,"div",13),u.TgZ(13,"div",14),u.TgZ(14,"button",15),u.NdJ("click",function(){return u.CHM(t),u.oxw().updatePostLikes()}),u._UZ(15,"img",16),u.qZA(),u.TgZ(16,"span",17),u._uU(17),u.qZA(),u.qZA(),u.qZA(),u.qZA()}if(2&t){const t=u.oxw();u.xp6(3),u.Q6J("src",t.userImage,u.LSH),u.xp6(2),u.hij(" ",t.post.user.username," "),u.xp6(2),u.hij("",t.post.post.createdAt," ago"),u.xp6(3),u.Oqu(t.post.post.description),u.xp6(1),u.hYB("src","",t.serverDir,"",t.post.post.imgUrl,"",u.LSH),u.xp6(6),u.hij("",t.post.post.likes.length," liked")}}let x=(()=>{class t{constructor(t,e,o,i,n,r){this.router=t,this.matDialog=e,this.route=o,this.postService=i,this.dataStorageService=n,this.authService=r,this.router.events.pipe((0,c.h)(t=>t instanceof s.OD),(0,a.b)(()=>this.matDialog.closeAll())).subscribe()}ngOnInit(){var t=this;return(0,r.Z)(function*(){t.serverDir=p.N.IMAGES_PATH,t.route.params.subscribe(e=>{t.postId=e.id}),t.userSubscription=t.authService.user.subscribe(e=>{t.user=e}),t.dataStorageService.getPost(t.postId),t.postSubscription=t.postService.postChanged.subscribe(e=>{t.post=e;const o=t.timeSince(new Date(t.post.post.createdAt).getTime()/1e3);t.post.post.createdAt=o,t.userImage=""===t.post.user.profilePicture||"assets/defaultProfile.png"===t.post.user.profilePicture?"assets/defaultProfile.png":t.serverDir+t.post.user.profilePicture}),t.post=t.postService.getPost()})()}goToUser(){this.router.navigate(this.user._id===this.post.post.creator?["/account"]:["user-profile",this.post.post.creator,"view"])}updatePostLikes(){this.dataStorageService.likePost(this.post.post._id).subscribe(t=>{this.post.post.likes=t.likes,this.postService.updatePost(this.post)})}timeSince(t){var e=Math.floor((new Date).getTime()/1e3-t),o=Math.floor(e/31536e3);return o>1?o+" year":(o=Math.floor(e/2592e3))>1?o+" month":(o=Math.floor(e/86400))>=1?o+" day":(o=Math.floor(e/3600))>=1?o+" hour":(o=Math.floor(e/60))>1?o+" minute":Math.floor(e)+" second"}ngOnDestroy(){this.postSubscription.unsubscribe(),this.userSubscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(u.Y36(s.F0),u.Y36(g.uw),u.Y36(s.gz),u.Y36(l.L),u.Y36(d.Z),u.Y36(f.e))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-show-post"]],decls:4,vars:2,consts:[[1,"post__wrapper"],[1,"loading__bar"],[4,"ngIf"],["class","post__card",4,"ngIf"],[1,"post__card"],[1,"postTop"],[1,"postTopLeft",3,"click"],["alt","",1,"postProfileImg",3,"src"],[1,"postUsername"],[1,"postDate"],[1,"postCenter"],[1,"postText"],["alt","",1,"postImg",3,"src"],[1,"postBottom"],[1,"postBottomLeft"],["mat-icon-button","",3,"click"],["src","assets/like.png","alt","",1,"likeIcon"],[1,"postLikeCounter"]],template:function(t,e){1&t&&(u.TgZ(0,"div",0),u.TgZ(1,"div",1),u.YNc(2,_,1,0,"app-loading-spinner",2),u.qZA(),u.YNc(3,b,18,7,"div",3),u.qZA()),2&t&&(u.xp6(2),u.Q6J("ngIf",!e.post),u.xp6(1),u.Q6J("ngIf",e.post))},directives:[i.O5,m.g,h.lW],styles:[".post__wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;width:600px;height:100%;margin-top:5%}.loading__bar[_ngcontent-%COMP%]{align-self:center}.post__card[_ngcontent-%COMP%]{margin-bottom:30px}.postTop[_ngcontent-%COMP%]{justify-content:space-between}.postTop[_ngcontent-%COMP%], .postTopLeft[_ngcontent-%COMP%]{display:flex;align-items:center}.postTopLeft[_ngcontent-%COMP%]{cursor:pointer}.postProfileImg[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;object-fit:cover}.postUsername[_ngcontent-%COMP%]{font-size:17px;font-weight:500;margin:0 10px}.postDate[_ngcontent-%COMP%]{font-size:12px}.postText[_ngcontent-%COMP%]{font-size:18px;font-weight:400}.postCenter[_ngcontent-%COMP%]{margin:20px 0}.postImg[_ngcontent-%COMP%]{margin-top:20px;max-width:100%;max-height:500px;object-fit:contain}.postBottom[_ngcontent-%COMP%]{justify-content:space-between}.postBottom[_ngcontent-%COMP%], .postBottomLeft[_ngcontent-%COMP%]{display:flex;align-items:center}.likeIcon[_ngcontent-%COMP%]{width:24px;height:24px;margin-right:10px;cursor:pointer}.postLikeCounter[_ngcontent-%COMP%]{font-size:15px;padding-left:20px}.postCommentText[_ngcontent-%COMP%]{cursor:pointer;border-bottom:1px dashed gray;font-size:15px}"]}),t})();var v=o(1041),P=o(7812),Z=o(7307),C=o(9624),M=o(2797);function S(t,e){1&t&&(u.TgZ(0,"p"),u._uU(1,"Edit Post"),u.qZA())}function w(t,e){1&t&&(u.TgZ(0,"p"),u._uU(1,"Create Post"),u.qZA())}function I(t,e){1&t&&u._UZ(0,"app-loading-spinner")}function T(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"div",15),u.TgZ(1,"label",16),u._UZ(2,"mat-icon",17),u._uU(3," Select Image "),u.qZA(),u.TgZ(4,"input",18),u.NdJ("change",function(e){return u.CHM(t),u.oxw(2).onFileChange(e)}),u.qZA(),u.qZA()}}function O(t,e){if(1&t&&u._UZ(0,"img",19),2&t){const t=u.oxw(2);u.Q6J("src",t.imagePath,u.LSH)}}function y(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"button",20),u.NdJ("click",function(){return u.CHM(t),u.oxw(2).onClearImage()}),u._UZ(1,"mat-icon",21),u.qZA()}}function A(t,e){if(1&t&&(u.TgZ(0,"button",22),u._uU(1," Save "),u.qZA()),2&t){const t=u.oxw(2);u.Q6J("disabled",!t.postForm.valid)}}function q(t,e){if(1&t&&(u.TgZ(0,"button",22),u._uU(1," Update "),u.qZA()),2&t){const t=u.oxw(2);u.Q6J("disabled",!t.imagePath)}}function U(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"form",4),u.NdJ("ngSubmit",function(){return u.CHM(t),u.oxw().onFormSubmit()}),u.TgZ(1,"div",5),u.TgZ(2,"label",6),u._uU(3,"Description"),u.qZA(),u._UZ(4,"input",7),u.qZA(),u.TgZ(5,"div",8),u.YNc(6,T,5,0,"div",9),u.YNc(7,O,1,1,"img",10),u.YNc(8,y,2,0,"button",11),u.qZA(),u.TgZ(9,"div",12),u.YNc(10,A,2,1,"button",13),u.YNc(11,q,2,1,"button",13),u.TgZ(12,"button",14),u.NdJ("click",function(){return u.CHM(t),u.oxw().onCancel()}),u._uU(13," Cancel "),u.qZA(),u.qZA(),u.qZA()}if(2&t){const t=u.oxw();u.Q6J("formGroup",t.postForm),u.xp6(6),u.Q6J("ngIf",!t.imagePath),u.xp6(1),u.Q6J("ngIf",t.imagePath),u.xp6(1),u.Q6J("ngIf",t.imagePath),u.xp6(2),u.Q6J("ngIf",!t.editMode),u.xp6(1),u.Q6J("ngIf",t.editMode)}}let k=(()=>{class t{constructor(t,e,o,i,n,s,r){this.dataStorageService=t,this.matIconRegistry=e,this.domSanitizer=o,this.authService=i,this.router=n,this.route=s,this.postService=r,this.editMode=!1,this.isLoading=!1,this.matIconRegistry.addSvgIcon("media",this.domSanitizer.bypassSecurityTrustResourceUrl("../../../assets/icons/media.svg")),this.matIconRegistry.addSvgIcon("close",this.domSanitizer.bypassSecurityTrustResourceUrl("../../../assets/icons/close.svg"))}ngOnInit(){var t=this;return(0,r.Z)(function*(){t.userSubscription=t.authService.user.subscribe(e=>{t.user=e}),t.route.params.subscribe(e=>{t.postId=e.id,t.editMode=null!=e.id}),t.editMode&&(t.isLoading=!0,yield t.dataStorageService.getPost(t.postId),t.isLoading=!1),t.initForm()})()}onFileChange(t){if(t.target.files&&t.target.files[0]){this.postForm.patchValue({fileSource:t.target.files[0]});var e=new FileReader;e.readAsDataURL(t.target.files[0]),e.onload=t=>{this.imagePath=t.target.result}}}onFormSubmit(){const t=localStorage.getItem("token"),e=new FormData;e.append("image",this.postForm.value.fileSource),e.append("description",this.postForm.value.description),e.append("userId",this.user._id),this.isLoading=!0,this.editMode?(e.append("imageUrl",this.postService.getPost().post.imgUrl),this.dataStorageService.updatePost(this.postId,e).subscribe(e=>{const o=new P.n(this.user._id,this.user.email,this.user.username,this.user.profilePicture,this.user.phoneNumber,this.user.bio,this.user.followers,this.user.followings,e,this.user.createdAt,this.user.updatedAt,t);this.authService.user.next(o),this.onCancel(),this.router.navigate(["/account"],{relativeTo:this.route})})):this.dataStorageService.createPost(e).subscribe(e=>{const o=new P.n(this.user._id,this.user.email,this.user.username,this.user.profilePicture,this.user.phoneNumber,this.user.bio,this.user.followers,this.user.followings,e,this.user.createdAt,this.user.updatedAt,t);this.authService.user.next(o),this.onCancel(),this.router.navigate(["/account"],{relativeTo:this.route})})}initForm(){let t="";if(this.editMode){const e=this.postService.getPost();t=e.post.description,this.imagePath=p.N.IMAGES_PATH+e.post.imgUrl}this.postForm=new v.cw({description:new v.NI(t,v.kI.required),fileSource:new v.NI("",v.kI.required)})}onCancel(){this.postForm.reset(),this.onClearImage()}onClearImage(){this.imagePath=""}ngOnDestroy(){this.userSubscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(u.Y36(d.Z),u.Y36(Z.jv),u.Y36(C.H7),u.Y36(f.e),u.Y36(s.F0),u.Y36(s.gz),u.Y36(l.L))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-create-post"]],decls:6,vars:4,consts:[[1,"post__wrapper"],[1,"title"],[4,"ngIf"],["class","form__group",3,"formGroup","ngSubmit",4,"ngIf"],[1,"form__group",3,"formGroup","ngSubmit"],[1,"form__field"],["for","description",1,"form__label"],["type","text","id","description","formControlName","description",1,"form__input"],[1,"image__box"],["class","image__selection",4,"ngIf"],["id","image__previewed",3,"src",4,"ngIf"],["type","button","id","unseclect__button","mat-icon-button","",3,"click",4,"ngIf"],[1,"control__buttons"],["mat-raised-button","","class","submit__button","type","submit",3,"disabled",4,"ngIf"],["mat-raised-button","","type","button",1,"control__button",3,"click"],[1,"image__selection"],["for","file-upload",1,"custom-file-upload"],["svgIcon","media"],["id","file-upload","type","file",3,"change"],["id","image__previewed",3,"src"],["type","button","id","unseclect__button","mat-icon-button","",3,"click"],["svgIcon","close"],["mat-raised-button","","type","submit",1,"submit__button",3,"disabled"]],template:function(t,e){1&t&&(u.TgZ(0,"mat-card",0),u.TgZ(1,"div",1),u.YNc(2,S,2,0,"p",2),u.YNc(3,w,2,0,"p",2),u.qZA(),u.YNc(4,I,1,0,"app-loading-spinner",2),u.YNc(5,U,14,6,"form",3),u.qZA()),2&t&&(u.xp6(2),u.Q6J("ngIf",e.editMode),u.xp6(1),u.Q6J("ngIf",!e.editMode),u.xp6(1),u.Q6J("ngIf",e.isLoading),u.xp6(1),u.Q6J("ngIf",e.postForm))},directives:[M.a8,i.O5,m.g,v._Y,v.JL,v.sg,v.Fj,v.JJ,v.u,h.lW,Z.Hw],styles:[".post__wrapper[_ngcontent-%COMP%]{margin-top:5%;width:500px;padding:10px}.title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-size:25px;font-weight:500;margin-bottom:30px}.form__group[_ngcontent-%COMP%]{height:calc(100% - 60px)}.form__field[_ngcontent-%COMP%], .form__group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form__field[_ngcontent-%COMP%]{margin-bottom:20px}.form__label[_ngcontent-%COMP%]{font-size:22px;padding-right:10px;margin-bottom:10px}.form__input[_ngcontent-%COMP%]{background:#0000;margin:0;outline-width:0;height:25px;padding-left:5px;font-size:16px;border:1px solid #ccc}.image__box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:475px;border:1px solid #ccc;margin-bottom:10px}#image__previewed[_ngcontent-%COMP%]{width:100%;height:100%;opacity:1}.image__box[_ngcontent-%COMP%]:hover   #image__previewed[_ngcontent-%COMP%]{opacity:.9}.image__box[_ngcontent-%COMP%]:hover   #unseclect__button[_ngcontent-%COMP%]{opacity:1}#unseclect__button[_ngcontent-%COMP%]{margin-left:-40px;opacity:0;align-self:flex-start}.control__buttons[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row-reverse}.submit__button[_ngcontent-%COMP%]{color:#fff;background-color:#007fff;margin-left:20px}.control__button[_ngcontent-%COMP%]{color:#fff;background-color:red}input[type=file][_ngcontent-%COMP%]{display:none}.custom-file-upload[_ngcontent-%COMP%]{display:flex;align-items:center;border:1px solid #ccc;display:inline-block;padding:6px 12px;cursor:pointer}"]}),t})();const J=[{path:"",redirectTo:"create"},{path:"create",component:k},{path:":id/view",component:x},{path:":id/edit",component:k}];let Y=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({imports:[[s.Bz.forChild(J)],s.Bz]}),t})();var N=o(3128);let F=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({imports:[[i.ez,Y,N.q,v.UX,n.m]]}),t})()}}]);